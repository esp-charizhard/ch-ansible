---
- name: Create Kubernetes Deployment for charizhard-server
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'ch-server-deploy.yml.j2') }}"
    kubeconfig: "/home/{{ ansible_user }}/.kube/config"

#- name: Create Keycloak Ingress
#  kubernetes.core.k8s:
#    state: present
#    definition:
#      apiVersion: networking.k8s.io/v1
#      kind: Ingress
#      metadata:
#        name: ch-server-ingress
#        namespace: default
#        annotations:
#          kubernetes.io/ingress.class: nginx
#          nginx.ingress.kubernetes.io/ssl-redirect: "true"
#          nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
#      spec:
#        tls:
#          - hosts:
#              - charizhard-wg.duckdns.org
#            secretName: example-tls-secret
#        rules:
#          - host: charizhard-wg.duckdns.org
#            http:
#              paths:
#                - path: /
#                  pathType: Prefix
#                  backend:
#                    service:
#                      name: charizhard-server-service
#                      port:
#                        name: http
#    kubeconfig: "/home/{{ ansible_user }}/.kube/config"