---

- name: Deploy basic keycloak test
  shell: kubectl  create -f https://raw.githubusercontent.com/keycloak/keycloak-quickstarts/refs/heads/main/kubernetes/keycloak.yaml --kubeconfig=/home/{{ ansible_user }}/.kube/config
  failed_when: false

- name: Patch keycloak service name
  kubernetes.core.k8s:
    api_version: v1
    kind: Service
    name: keycloak
    namespace: default
    kubeconfig: "/home/{{ ansible_user }}/.kube/config"
    resource_definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: keycloak-service
        namespace: default
      spec:
        type: LoadBalancer
